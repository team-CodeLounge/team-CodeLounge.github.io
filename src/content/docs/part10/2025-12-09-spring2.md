---
title: Docker ì„¸íŒ…
description: A reference page in my new Starlight docs site.
---

## ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ ìƒì„±(ìµœì´ˆ 1ë²ˆ)
composeì—ì„œ external: trueë¡œ ì„¤ì •í•˜ê¸° ìœ„í•´ ë„¤íŠ¸ì›Œí¬ ìƒì„±
```bash
docker network create server-base-net
```

## Mysql ì»¨í…Œì´ë„ˆ ìƒì„±
```docker
# docker compose.yml
# ----------------------------------------
# ğŸ”— ì™¸ë¶€ì—ì„œ ì´ë¯¸ ë§Œë“¤ì–´ë‘” Docker ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©
#    - docker network create server-base-net ë¡œ ì‚¬ì „ ìƒì„± í•„ìš”
#    - composeê°€ ë„¤íŠ¸ì›Œí¬ë¥¼ ìƒˆë¡œ ë§Œë“¤ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ê°€ì ¸ë‹¤ ì”€
# ----------------------------------------
networks:
  server-base-net:
    external: true

services:
  mysql:
    # ì‚¬ìš©í•  MySQL Docker ì´ë¯¸ì§€
    image: mysql:8.0
    container_name: server-base-mysql

    # ì»¨í…Œì´ë„ˆê°€ ì¤‘ì§€ë˜ë©´ ìë™ ì¬ì‹œì‘
    restart: unless-stopped

    # MySQL ê¸°ë³¸ ì„¤ì •(Environment Variables)
    environment:
      MYSQL_ROOT_PASSWORD:               # root ê³„ì • ë¹„ë°€ë²ˆí˜¸
      MYSQL_DATABASE: server_base_db     # ìë™ ìƒì„±í•  DB ì´ë¦„
      MYSQL_USER: server_base            # ìë™ ìƒì„±í•  ì‚¬ìš©ì ê³„ì •
      MYSQL_PASSWORD:                    # í•´ë‹¹ ì‚¬ìš©ì ë¹„ë°€ë²ˆí˜¸

    # í˜¸ìŠ¤íŠ¸í¬íŠ¸ : ì»¨í…Œì´ë„ˆ ë‚´ë¶€ MySQL í¬íŠ¸
    # í˜¸ìŠ¤íŠ¸ì—ì„œ 5011 â†’ ì»¨í…Œì´ë„ˆ 3306ìœ¼ë¡œ ì ‘ì† ê°€ëŠ¥
    ports:
      - "5011:3306"

    # DB íŒŒì¼ì„ ì˜êµ¬ ì €ì¥í•˜ê¸° ìœ„í•œ ë³¼ë¥¨ (ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘í•´ë„ ë°ì´í„° ìœ ì§€)
    volumes:
      - mysql_data:/var/lib/mysql

    # ìœ„ì—ì„œ ì„ ì–¸í•œ ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì— ì»¨í…Œì´ë„ˆ ì—°ê²°
    networks:
      - server-base-net

# ----------------------------------------
# ğŸ’¾ MySQL ì˜êµ¬ ì €ì¥ ë³¼ë¥¨
#    - ì‹¤ì œ DB ë°ì´í„°ëŠ” mysql_data ë³¼ë¥¨ì— ì €ì¥ë¨
# ----------------------------------------
volumes:
  mysql_data:

```

## ì»¨í…Œì´ë„ˆ ëª…ë ¹ì–´
```bash
# ì‹¤í–‰ 
# -d : ë°±ê·¸ë¼ìš´ë“œ(detached) ì‹¤í–‰
# - ì²« ì‹¤í–‰ ë•Œ ì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ pull ë¨
docker compose up -d

# ì»¨í…Œì´ë„ˆ ì¢…ë£Œ, ë°ì´í„° ìœ ì§€
docker compose down

# ì™„ì „íˆ ì‚­ì œ(ì»¨í…Œì´ë„ˆ + ë³¼ë¥¨ + ë„¤íŠ¸ì›Œí¬ ì œì™¸)
docker compose down -v

# ë„¤íŠ¸ì›Œí¬ ì‚­ì œ
docker network rm server-base-net

# ì „ì²´ ì‚­ì œ í›„ ì™„ì „ ì´ˆê¸°í™” ì¬ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ
docker compose down -v
docker network rm server-base-net
docker network create server-base-net
docker compose up -d
```

## ì •ìƒ ì‹¤í–‰ ì—¬ë¶€ í™•ì¸
```docker
docker ps
mysql -h 127.0.0.1 -P 5011 -u server_base -p
docker exec -it server-base-mysql mysql -u server_base -p
```

## Spring JAR íŒŒì¼ë¡œ DockeríŒŒì¼ ìƒì„±
```bash
# Dockerfile
# -----------------------------------------------------------
# ğŸ”¹ 1. ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì„ íƒ
#    - eclipse-temurin:17-jdk-jammy : Java 17 JDK + Ubuntu ê¸°ë°˜
#    - Spring Boot 3.x ì´ìƒì€ Java 17 ê¶Œì¥
# -----------------------------------------------------------
FROM eclipse-temurin:17-jdk-jammy

# -----------------------------------------------------------
# ğŸ”¹ 2. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
#    - ì´í›„ COPY, RUN ë“± ëª¨ë“  ëª…ë ¹ì€ /app ê¸°ì¤€ìœ¼ë¡œ ì‹¤í–‰ë¨
# -----------------------------------------------------------
WORKDIR /app

# -----------------------------------------------------------
# ğŸ”¹ 3. JAR íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ë³µì‚¬
#    - build/libs/*.jar : Gradleë¡œ ë¹Œë“œëœ JAR ê²½ë¡œ
#    - app.jar ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì»¨í…Œì´ë„ˆì— ì €ì¥
# -----------------------------------------------------------
COPY build/libs/*.jar app.jar

# -----------------------------------------------------------
# ğŸ”¹ 4. ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ì‹œê°„ëŒ€ë¥¼ í•œêµ­(ì„œìš¸)ë¡œ ì„¤ì •
#    - ë¡œê·¸/ì‹œê°„ ê³„ì‚°ì´ í•œêµ­ ê¸°ì¤€ìœ¼ë¡œ ë§ê²Œ ë‚˜ì˜´
# -----------------------------------------------------------
ENV TZ=Asia/Seoul

# -----------------------------------------------------------
# ğŸ”¹ 5. Spring Boot ì„œë²„ê°€ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ ë…¸ì¶œ
#    - ê¸°ë³¸ì ìœ¼ë¡œ Spring BootëŠ” 8080 í¬íŠ¸ ì‚¬ìš©
# -----------------------------------------------------------
EXPOSE 8080

# -----------------------------------------------------------
# ğŸ”¹ 6. ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œ ì‹¤í–‰í•  ëª…ë ¹
#    - java -jar app.jar ì‹¤í–‰
#    - ENTRYPOINTëŠ” ì»¨í…Œì´ë„ˆ ë©”ì¸ í”„ë¡œì„¸ìŠ¤
# -----------------------------------------------------------
ENTRYPOINT ["java", "-jar", "app.jar", "--spring.profiles.active=prod"]
```

## Docker ë¹Œë“œ ëª…ë ¹ì–´
```bash
# 1. Gradle í´ë¦° + JAR ë¹Œë“œ
./gradlew clean bootJar

# 2. Docker ë¹Œë“œ (ë¡œì»¬ì—ì„œë§Œ ì‚¬ìš©)
docker buildx build --platform linux/amd64 -t server-base-api:1.0.0 --load .

# 3. latest íƒœê·¸ ë‹¬ê¸° (ì„ íƒ)
docker tag server-base-api:1.0.0 server-base-api:latest
```

## Docker ë¡œê·¸ ì¶œë ¥ ëª…ë ¹ì–´
```bash
# ë¡œê·¸ ì „ì²´ ì¶œë ¥ 
docker logs server-base-api

# ì‹¤ì‹œê°„ ë¡œê·¸ ë³´ê¸° 
docker logs -f server-base-api
```

## ë„ì»¤ ì»¨í…Œì´ë„ˆ ë¡œì»¬ ë¹Œë“œ & tar ìƒì„±(local_build.sh)
```bash
#!/bin/bash
# =============================================
# local_build.sh
# chmod +x local_build.sh
#
# ğŸ“Œ ë¡œì»¬ ë¹Œë“œ ì „ìš© ìŠ¤í¬ë¦½íŠ¸
# 1) Gradleë¡œ JAR ë¹Œë“œ
# 2) Docker ì´ë¯¸ì§€ ë¹Œë“œ (linux/amd64)
# 3) Docker ì´ë¯¸ì§€ tar íŒŒì¼ ìƒì„±
#
# â–¶ ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì–´
#    ./gradlew clean bootJar
#    docker buildx build --platform linux/amd64 -t server-base-api:1.0.0 --load .
#    docker tag server-base-api:1.0.0 server-base-api:latest   # ì„ íƒ
#    docker save -o server-base-api-1.0.0.tar server-base-api:1.0.0
# =============================================

set -e  # ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ

# =============================
# í™˜ê²½ ë³€ìˆ˜ (Makefileê³¼ ë™ì¼)
# =============================
APP_NAME="server-base-api"
VERSION="1.0.0"
IMAGE_NAME="${APP_NAME}:${VERSION}"
IMAGE_TAR="${APP_NAME}-${VERSION}.tar"

# =============================
# ìƒ‰ìƒ ì¶œë ¥
# =============================
GREEN="\033[0;32m"
RED="\033[0;31m"
NC="\033[0m"

# =============================
# Step 1. Gradle ë¹Œë“œ
# =============================
echo -e "${GREEN}ğŸ“Œ Step 1/3: Gradle Build - bootJar ì‹¤í–‰ ì¤‘...${NC}"
./gradlew clean bootJar

echo -e "${GREEN}âœ… JAR ë¹Œë“œ ì™„ë£Œ: build/libs/*.jar${NC}"
echo ""

# =============================
# Step 2. Docker ì´ë¯¸ì§€ ë¹Œë“œ
# =============================
echo -e "${GREEN}ğŸ“Œ Step 2/3: Docker ì´ë¯¸ì§€ ë¹Œë“œ ì¤‘...${NC}"
echo -e "${GREEN}   - ì´ë¯¸ì§€ ì´ë¦„: ${IMAGE_NAME}${NC}"
echo ""

docker buildx build --platform linux/amd64 -t "${IMAGE_NAME}" --load .

# ì„ íƒ: latest íƒœê·¸ ì¶”ê°€ ê°€ëŠ¥
# docker tag "${IMAGE_NAME}" "${APP_NAME}:latest"

echo -e "${GREEN}ğŸ‰ Docker ì´ë¯¸ì§€ ë¹Œë“œ ì™„ë£Œ!${NC}"
echo ""

# =============================
# Step 3. Docker ì´ë¯¸ì§€ tar íŒŒì¼ë¡œ ì €ì¥
# =============================
echo -e "${GREEN}ğŸ“Œ Step 3/3: Docker ì´ë¯¸ì§€ tar íŒŒì¼ ìƒì„± ì¤‘...${NC}"
echo -e "${GREEN}   - ì¶œë ¥ íŒŒì¼: ${IMAGE_TAR}${NC}"

docker save -o "${IMAGE_TAR}" "${IMAGE_NAME}"

echo ""
echo -e "${GREEN}ğŸ‰ ì™„ë£Œ! ë‹¤ìŒ íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤:${NC}"
echo -e "${GREEN}   - Docker Image: ${IMAGE_NAME}${NC}"
echo -e "${GREEN}   - TAR íŒŒì¼: ${IMAGE_TAR}${NC}"
echo ""
```

## tar íŒŒì¼ì„ ì„œë²„ë¡œ ì „ì†¡
```bash
# remote_build.sh
# ì„œë²„ì—ì„œ tar ë¡œë“œ â†’ ê¸°ì¡´ ì»¨í…Œì´ë„ˆ ì¢…ë£Œ â†’ ìƒˆ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
#!/bin/bash
# =============================================
# remote_build.sh
# chmod +x remote_build.sh
#
# ğŸ“Œ ì›ê²© ë¹Œë“œ/ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ (tar íŒŒì¼ ì „ì†¡)
# 1) (ë¡œì»¬ì—ì„œ ì´ë¯¸ ìƒì„±ëœ) Docker tar íŒŒì¼ ì„œë²„ë¡œ ì „ì†¡
#
# â–¶ ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ëª…ë ¹ì–´
#    scp server-base-api-1.0.0.tar poppang-server:/home/poppang/test/
#
# ë§¤ê°œë³€ìˆ˜ ì‚¬ìš©ë²•
#    ./remote_build.sh server-base-api 1.0.0
#    ./remote_build.sh                       # ê¸°ë³¸ê°’ ì‚¬ìš©
# =============================================

set -e  # ì—ëŸ¬ ë°œìƒ ì‹œ ì¦‰ì‹œ ì¢…ë£Œ

# =============================
# ì…ë ¥ íŒŒë¼ë¯¸í„° (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
# =============================
APP_NAME="${1:-server-base-api}"
VERSION="${2:-1.0.0}"
IMAGE_NAME="${APP_NAME}:${VERSION}"
IMAGE_TAR="${APP_NAME}-${VERSION}.tar"

# =============================
# ì„œë²„ ì •ë³´
# =============================
SSH_HOST="poppang-server"
SERVER_DIR="/home/poppang/test"

# =============================
# ìƒ‰ìƒ ì¶œë ¥
# =============================
GREEN="\033[0;32m"
RED="\033[0;31m"
NC="\033[0m"

# =============================
# Step 1. TAR íŒŒì¼ ì„œë²„ ì „ì†¡
# =============================
echo -e "${GREEN}ğŸšš Step 1/1: Docker ì´ë¯¸ì§€ tar ì„œë²„ë¡œ ì „ì†¡ ì¤‘...${NC}"
echo -e "${GREEN}   - ì „ì†¡ íŒŒì¼: ${IMAGE_TAR}${NC}"
echo -e "${GREEN}   - ì„œë²„ ê²½ë¡œ: ${SSH_HOST}:${SERVER_DIR}/${NC}"
echo ""

# tar íŒŒì¼ ì¡´ì¬ í™•ì¸
if [ ! -f "${IMAGE_TAR}" ]; then
  echo -e "${RED}âŒ ì˜¤ë¥˜: tar íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${IMAGE_TAR}${NC}"
  echo -e "${RED}   ë¨¼ì € local_build.sh ë¥¼ ì‹¤í–‰í•˜ì—¬ tar íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.${NC}"
  exit 1
fi

scp "${IMAGE_TAR}" "${SSH_HOST}:${SERVER_DIR}/"

echo -e ""
echo -e "${GREEN}ğŸ‰ TAR íŒŒì¼ ì „ì†¡ ì™„ë£Œ!${NC}"
echo -e "${GREEN}   - ì„œë²„ì— ì €ì¥ë¨: ${SERVER_DIR}/${IMAGE_TAR}${NC}"
echo ""

# =============================
# Step 2. ì„œë²„ì—ì„œ deploy-prod.sh ì‹¤í–‰
# =============================
echo -e "${GREEN}ğŸš€ Step 2/2: ì„œë²„ì—ì„œ deploy-prod.sh ì‹¤í–‰ ì¤‘...${NC}"
ssh ${SSH_HOST} "bash ${SERVER_DIR}/deploy-prod.sh ${SERVER_DIR}/${IMAGE_TAR} ${IMAGE_NAME}"
```

## ì„œë²„ì—ì„œ tar ë¡œë“œ & ì»¨í…Œì´ë„ˆ ì‹¤í–‰
```bash
# deploy-prod.sh
#!/usr/bin/env bash
set -e

IMAGE_TAR="$1"          # ì˜ˆ: server-base-api-1.0.0.tar
IMAGE_NAME="$2"         # ì˜ˆ: server-base-api:1.0.0

if [ -z "$IMAGE_TAR" ] || [ -z "$IMAGE_NAME" ]; then
  echo "Usage: $0 <image-tar-path> <image-name:tag>"
  exit 1
fi

echo ">>> Docker image load: $IMAGE_TAR"
docker load -i "$IMAGE_TAR"

echo ">>> Stop & remove old container: server-base-api"
docker rm -f server-base-api 2>/dev/null || true

echo ">>> Run new container: $IMAGE_NAME"
docker run -d --name server-base-api \
  -p 5010:8080 \
  --restart unless-stopped \
  --network server-base-net \
  -e SPRING_PROFILES_ACTIVE=prod \
  "$IMAGE_NAME"

echo ">>> DONE"
```