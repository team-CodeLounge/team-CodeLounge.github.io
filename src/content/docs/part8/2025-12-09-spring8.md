---
title: Google 로그인 OAuth 2.0 
description: A reference page in my new Starlight docs site.
---

## Oauth
인증은 유저가 직접, 권한은 서비스에게  
Oauth(Open Authorization)은 인터넷 사용자들이 비밀번호를 제공하지 않고 다른 웹사이트 상의 자신들의 정보에 대해 웹사이트나 애플리케이션의 접근 권한을 부여할 수 있는 공통 수단으로 사용되는 접근 위임을 위한 개방형 표준이다.

## Oauth 2.0
Oauth2.0은 Oauth 차세대 버전으로 현대의 모든 소셜 로그인이 사용하는 표준 인증/권한 위임 프로토콜이다.

## Oauth 2.0 핵심 구성 요소
`Authorization Code`  
    - 사용자가 로그인 완료 후, 서비스가 받는 일회용 코드  
`Access Token`  
    - 사용자 정보(API)를 요청할 수 있는 권한 토큰  
`Refresh Token`  
    - Access Token이 만료될 때 다시 갱신할 수 있는 장기 토큰  
`Resource Server`  
    - 사용자 정보가 저장된 서버 (Google UserInfo API 등)  
`Client Application`  
    - OAuth를 사용하는 서버(우리 시스템)  

## OAuth 2.0의 대표적인 인증 흐름
![alt text](/images/part8/2025-12-09-spring8/image.png)
### 1. 사용자가 Google 로그인 요청
- 사용자가 “구글 로그인” 버튼을 클릭하면 Google 로그인 페이지로 이동
- Google OAuth 2.0 인증 화면에서 사용자는 자신의 구글 계정으로 로그인하고 권한을 허용함

### 2. 인가 코드(Authorization Code)를 반환
- 사용자가 로그인 및 권한 동의를 완료하면 Google은 설정된 Redirect URI로 인가 코드를 전달
- 이 코드는 일회용이며, 서버가 Access Token을 요청할 때 사용됨

### 3. 인가 코드를 서버로 전달
- 클라이언트는 구글에서 받은 인가 코드를 Spring 서버 엔드포인트로 전송
- 이 과정에서 서버는 인가 코드를 받아, 이를 사용하여 구글 서버에 엑세스 토큰을 요청할 준비를 함

### 4. Access Token을 요청
- 서버는 수신한 인가 코드를 이용해 Google Token 엔드포인트로 Access Token을 요청
- 요청에는 다음이 포함됨
    - Client ID
    - Client Secret
    - Redirect URI
    - 인가 코드
    - grant_type=authorization_code

### 5. Access Token을 반환
- Google은 Spring 서버의 요청을 검증한 뒤 Access Token(및 필요한 경우 Refresh Token)을 반환
- Access Token은 사용자의 구글 정보(UserInfo)에 접근할 수 있는 권한을 포함함

### 6. 사용자 정보 요청
- Spring 서버는 받은 엑세스 토큰을 이용해 구글 사용저 정보 API에 접근하여 사용자 프로필 정보(이메일, 이름 등)을 요청
- 이 요청은 엑세스 토큰을 사용하여 인증을 수행

### 7. 사용자 정보 반환
- 구글은 서버의 요청에 따라 사용자 프로필 정보를 반환
- 이 정보는 사용자 고유ID, 이메일, 이름, 프로필 사진 등의 데이터 포함 가능

### 8. 서버에서 회원 등록 및 서버 엑세스 토큰 생성
- Spring 서버는 구글 서버에서 받은 사용자 정보를 통해 사용자를 데이터베이스에 등록 or 이미 등록된 사용자라면 로그인 처리(JWT활용 가능)

### 9. 서버 엑세스 토큰을 클라이언트에 반환(JWT사용시)
- 서버는 자체적으로 생성한 서버 엑세스 토큰을 클라이언트로 반환
- 클라이언트는 이 토큰을 저장하고 이후 애플리케이션의 보호된 리소스에 접근 가능


<!-- 1. 사용자가 Google 로그인 페이지로 이동
2. Google이 사용자를 인증
3. Google이 우리 서버에게 Authorization Code 전달
4. 서버가 Code를 이용해 Google Token 서버에서 Access Token 요청
5. Access Token을 이용해 사용자 프로필(UserInfo) 조회
6. 서버는 프로필을 이용해 자체 로그인 처리
7. 클라이언트에게 자체 토큰(예: JWT) 또는 세션 발급 -->

## 구글 클라우드 프로젝트 생성하기
![alt text](/images/part8/2025-12-09-spring8/image1.png)
- [Google Cloud](https://console.cloud.google.com/welcome?project=server-base-aapi&authuser=2)에서 프로젝트 생성하기  
- 오탈자로 a가 하나 더 들어갔지만 신경쓰지 않아도 된다.
<br/><br/>

![alt text](/images/part8/2025-12-09-spring8/image2.png)
- API 및 서비스 -> 사용자 인증 정보 -> Oauth동의 화면 -> 시작 -> 앱정보작성 및 만들기
- 외부 -> 이메일 -> 만들기
<br/><br/>

![alt text](/images/part8/2025-12-09-spring8/image3.png)
![alt text](/images/part8/2025-12-09-spring8/image4.png)
```bash
# 웹 클라이언트 승인된 리다이렉션URL 추가
https://localhost:8080/api/v1/auth/google/mobile/login
https://dev.poppang.co.kr/api/v1/auth/google/mobile/login
```
- API 및 서비스 -> 클라이언트 -> OAuth 클라이언트 ID 만들기
- 웹 클라이언트를 만들떄는 승인된 리다이렉션URL을 추가하자
<br/><br/>

## 프로젝트 설정
resources -> application.yml, application-local.yml, application-prod.yml 3개 생성
```bash
# application.yml
spring:
  application:
    name: server-base-api

  profiles:
    active: local   # 기본값 (IntelliJ 실행하면 local)

# application-local.yml
# 구글 환경 변수
google:
  client-id: 
  client-secret: 
  redirect-uri:
  token-uri: 
  user-info-uri: 
  scope:
    - email
    - profile
# application-prod.yml
```

## 앱 클라이언트 ID도 생성
iOS 소셜 로그인을 위해 사용자 인증 정보 -> 사용자 인증 정보 만들기 -> OAuth 클라이언트ID -> iOS로 생

## 프로젝트 구글 폴더 구조
```bash
com.serverbaseapi
 ├── be.common.util
 │     └── Logger                      # 공용 로그 유틸리티
 │
 └── domain.auth.google                # Google OAuth 도메인 모듈
       ├── application
       │     └── GoogleAuthService     # Google OAuth 비즈니스 로직
       │
       ├── config
       │     └── GoogleProperties      # Google OAuth 환경 변수 설정 바인딩
       │
       └── dto
             ├── request
             │     └── GoogleLoginRequestDto       # 클라이언트 로그인 요청 DTO
             │
             └── response
                   ├── GoogleTokenResponseDto      # Google Token API 응답 DTO
                   └── GoogleUserInfoResponseDto   # Google UserInfo API 응답 DTO
```

## Swift 프로젝트 설정
1. AppDelegate 설정
```swift
// AppDelegate.swift
import UIKit
import GoogleSignIn

class AppDelegate: UIResponder, UIApplicationDelegate {
    
    /// 앱 실행 완료된 후 초기 설정 진행
    /// - Parameters:
    ///   - application: 현재 실행 중인 앱 객체
    ///   - launchOptions: 앱 실행 시 전달된 설정 정보 딕셔너리(푸시 알림, URL Scheme등)
    /// - Returns: 앱 실행이 성공적으로 완료되었는지 나타내는 Bool값
    ///
    /// - Important: 이 메서드에서 Kakao SDK 초기화를 성공해야 카카오 로그인 및 API 가 정상 동작
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        return true
    }
    
    /// 앱이 외부 URL을 열 때 호출
    /// - Parameters:
    ///   - app: 현재 실행 중인 앱 객체
    ///   - url: 열리는 외부 리소스 URL (ex: 카카오톡 로그인 콜백)
    ///   - options: URL 열기 동작과 관련된 추가 옵션 정보
    /// - Returns: URL을 정상적으로 처리했는지 나타내는 Bool값
    ///
    /// - Note: 카카오톡 로그인 시 카카오톡 앱에서 인증 후 돌아오는 URL을 처리한다
    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey : Any] = [:]) -> Bool {
        
        // MARK: - Google
        if GIDSignIn.sharedInstance.handle(url) {
            return true
        }
        return true
    }
}
```

2. Info.plist 설정
```swift
<key>GIDClientID</key>
<string>${GIDClientID}</string>
<key>GoogleURLScheme</key>
<string>${GoogleURLScheme}</string>
```

3. Project -> Targets -> Info -> URL Types -> ${GoogleURLScheme}

## Reference
- https://velog.io/@alswp006/Spring-OAuth-2.0으로-구글-로그인-구현하기
- https://engineerinsight.tistory.com/163
- https://velog.io/@nays33/GoogleLogin-구글-소셜-로그인-구현-2-스프링-시큐리티와-OAuth2.0를-이용한-구글로그인