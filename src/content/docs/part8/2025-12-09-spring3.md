---
title: Nginx 세팅
description: A reference page in my new Starlight docs site.
---

## Nginx 기본 구조
```bash
/etc/nginx/sites-available
/etc/nginx/sites-enabled
```
- Ubuntu에서 Nginx는 두 폴더를 사용해 도메인 설정을 관리한다
- `sites-available`: 도메인 설정 파일을 보관하는 장소 / 서버에서 사용되는 것은 아닌 보관용
- `sites-enabled`: 실제로 서버가 사용되는 설정 파일 목록(활성 목록)
<br/><br/>


```bash
# 예시
/etc/nginx/sites-enabled/poppang.co.kr -> ../sites-available/poppang.co.kr

# 구조
sites-available/
│── poppang.co.kr           ← 진짜 파일 (원본)
│── dev.poppang.co.kr       ← 진짜 파일 (원본)

sites-enabled/
│── poppang.co.kr -> ../sites-available/poppang.co.kr   ← 링크
│── dev.poppang.co.kr -> ../sites-available/dev.poppang.co.kr  ← 링크
```
- sites-enabled에 있는 파일을 심볼릭 링크로 연결한 것만 실제로 적용됨
<br/><br/>

## Nginx 설치
```bash
sudo apt update
sudo apt install nginx -y
```

## Nginx 도메인 파일 생성
```bash
# 만들려는 도메인이 dev.poppang.co.kr이라면
sudo vi /etc/nginx/sites-available/dev.poppang.co.kr
```

## SSL인증서 발급 전 리다이렉트 없는 HTTP서버만 작성
```bash
server {
    listen 80;
    server_name dev.poppang.co.kr;

    location / {
        proxy_pass http://127.0.0.1:5010;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```
- 인증서 발급 전에는 HTTP만 열어두고 (리다이렉트 X)
- Spring Boot 5010으로 프록시만 한다

## 활성화
```bash
sudo ln -s /etc/nginx/sites-available/dev.poppang.co.kr \
           /etc/nginx/sites-enabled/dev.poppang.co.kr
```

## Nginx 테스트 후 반영
```bash
sudo nginx -t
sudo systemctl reload nginx
```

## SSL 발급
```bash
sudo certbot --nginx -d dev.poppang.co.kr
```

## 발급 후 최종 Nginx구조
```bash
# /etc/nginx/sites-available/dev.poppang.co.kr 
# HTTP → HTTPS 리다이렉트
server {
    listen 80;
    server_name dev.poppang.co.kr;

    return 301 https://$host$request_uri;
}

# HTTPS 실제 서비스 (Spring 5010)
server {
    listen 443 ssl;
    server_name dev.poppang.co.kr;

    ssl_certificate     /etc/letsencrypt/live/dev.poppang.co.kr/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/dev.poppang.co.kr/privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:5010;

        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Host $host;

        # ✅ Swagger UI 등에서 브라우저 요청 허용
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Methods 'GET, POST, OPTIONS, PUT, DELETE';
        add_header Access-Control-Allow-Headers 'Authorization, Content-Type, Accept, Origin, User-Agent, DNT, Cache-Control, X-Mx-ReqToken, Keep-Alive, X-Requested-With, If-Modified-Since';
    }
}
```

## 다시 Nginx 테스트 후 반영
```bash
sudo nginx -t
sudo systemctl reload nginx
```